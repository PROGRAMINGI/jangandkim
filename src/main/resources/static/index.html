<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주차장 관리 시스템</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* 기존 스타일 유지 */
        .no-content-message {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: #666;
            text-align: center;
            padding: 20px;
        }

        .no-content-message i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ccc;
        }

        .no-content-message h2 {
            margin-bottom: 10px;
            color: #333;
        }

        .no-content-message p {
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Top Section -->
    <div class="top">
        <button id="toggle-menu">☰ 즐겨찾기</button>
        <div id="menu"></div>
    </div>

    <!-- Middle Section -->
    <div class="mid" id="content-area">
        <div class="no-content-message" style="display: none;">
            <i class="fas fa-parking"></i>
            <h2>등록된 주차장이 없습니다</h2>
            <p>주차장을 먼저 등록해주세요</p>
        </div>
        <iframe id="iframe" style="display: none;" frameborder="0"></iframe>
    </div>

    <!-- Bottom Section -->
    <div class="bottom">
        <button class="nav-button active" data-page="layoutView">
            <i class="fas fa-home"></i>
        </button>
        <button class="nav-button" data-page="naverMapEditor">
            <i class="fas fa-map-marker-alt"></i>
        </button>
        <button class="nav-button" data-page="editor">
            <i class="fas fa-user"></i>
        </button>
    </div>

    <script>
        const toggleMenu = document.getElementById('toggle-menu');
        const menu = document.getElementById('menu');
        const iframe = document.getElementById('iframe');
        const noContentMessage = document.querySelector('.no-content-message');

        async function fetchFavoritesFromServer() {
            try {
                const response = await fetch('/api/favorites');
                if (!response.ok) throw new Error('즐겨찾기 데이터를 가져오는 데 실패했습니다.');
                return await response.json();
            } catch (error) {
                console.error('즐겨찾기 데이터를 가져오는 중 오류 발생:', error);
                return [];
            }
        }

        async function updateMenu() {
            const favorites = await fetchFavoritesFromServer();
            menu.innerHTML = '';

            if (favorites.length === 0) {
                const emptyMessage = document.createElement('p');
                emptyMessage.textContent = "즐겨찾기가 없습니다";
                emptyMessage.style.color = "#fff";
                emptyMessage.style.textAlign = "center";
                menu.appendChild(emptyMessage);
            } else {
                favorites.forEach(favorite => {
                    const button = document.createElement('button');
                    button.textContent = `주차공간: ${favorite.spaceNumber}`; // spaceId 대신 spaceNumber 표시
                    button.onclick = () => navigateTo('layoutView', favorite.spaceID);
                    menu.appendChild(button);
                });
            }
        }

        toggleMenu.addEventListener('click', async () => {
            const isOpen = menu.classList.contains('open');
            if (!isOpen) {
                await updateMenu();
            }
            menu.classList.toggle('open');
        });

        async function navigateTo(page, spaceId = null) {
            const favorites = await fetchFavoritesFromServer();
            
            if (favorites.length === 0 && page === 'layoutView') {
                iframe.style.display = 'none';
                noContentMessage.style.display = 'flex';
            } else {
                iframe.style.display = 'block';
                noContentMessage.style.display = 'none';
                
                let url = `${page}.html`;
                if (spaceId) {
                    url += `?spaceID=${spaceId}`;
                }
                iframe.src = url;
            }

            // 활성화된 버튼 스타일 업데이트
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.toggle('active', button.dataset.page === page);
            });
        }

        // 페이지 초기화
        document.addEventListener('DOMContentLoaded', async () => {
            await navigateTo('layoutView');
        });

        // 하단 네비게이션 버튼 이벤트 리스너 추가
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', () => navigateTo(button.dataset.page));
        });
    </script>
</body>
</html>